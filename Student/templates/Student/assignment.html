{% extends './base_student.html' %}
{% load static %}

{% block title %}
<title>Submit Assignment</title>
{% endblock title %}

{% block styles %}
<link href="{% static 'Student/assets/css/assignment.css' %}" rel="stylesheet">
{% endblock styles %}


{% block navbar %}
<header id="header" class="header d-flex align-items-center">

    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
      <a href="#" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1>EDUMATE<span>.</span></h1>
      </a>
      <nav id="navbar" class="navbar">
        <ul>
          <li>
            <a class="btn" href="{% url 'classroom1' pk=pk pk2=pk2 %}">Back</a>
          </li>
          
          <li class="dropdown">
            <a href="#">
              <span>Hello {{request.session.sname}}!</span> <i class="bi bi-chevron-down dropdown-indicator"></i>
            </a>
            <ul>
              <li>
                {% if pk %}
                <a href="{% url 'logout' pk=pk %}">logout</a>
                {% else %}
                <a href="{% url 'logout' pk=pk1 %}">logout</a>
                {% endif %}
              </li>
            </ul>
          </li>
        </ul>
      </nav><!-- .navbar -->

      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>


    </div>
  </header>
  {% endblock navbar %}

{% block content %}
<style>
  .btn-success, .btn-success:active, .btn-success:visited {
    background-color: #008374 !important;
  }
  
  .btn-success:hover {
    border-color: #008374 !important;
    background-color: white !important;
    color: #008374 !important;
  }
  b {
    font-size: 18px;
  }

  @media screen and (max-width: 500px) {
    .main-content {
      width: 95vw;
    }
  }
  
  @media screen and (min-width: 501px and max-width: 800px) {
    .main-content {
      width: 45vw;
    }
  }

  @media screen and (min-width: 801px) {
    .main-content {
      width: 30vw;
    }
  }
  

</style>

{% if messages %}
        {% for message in messages %}
         {% if message.tags %}  
         <script>alert('{{ message }}')</script>
        {% endif %}

        {% endfor %}

    {% endif %}

    {% comment %} <div>
      <p style="padding-top: 30px">Assignment name: {{ assign.0.assignment_name }}</p> 
      <p>Assignment description : {{ assign.0.assignment_description }}</p>
      <p>Marks : {{ assign.0.max_marks }}</p>
      <p>Due date : {{ assign.0.duedate }}</p>
    </div>
    <div>
        <form method="post" enctype="multipart/form-data" >
            {% csrf_token %}
            <input class="form-control" type="text" placeholder="Enter assignment description" name="description">
            <input class="form-control" type="file" placeholder="Upload pdf file" name="submission">
            <button class="btn btn-outline-success" type="submit">Submit</button>
        </form>
    </div>
    <div>
      {% if pflag %}
      {% if desc1 != "X" and desc2 != "X" %}
      <form method="post">
          {% csrf_token %}
          <p>File: <a target="_blank" href="{{ desc1.assign_file.url }}">View Doc</a></p>
          <input type="number" placeholder="Enter marks" name="peer1">
          <p>File: <a target="_blank" href="{{ desc2.assign_file.url }}">View Doc</a></p>
          <input type="number" placeholder="Enter marks" name="peer2">
          <input type="text" name="caller" value="call" style="display: none">
          <button class="btn btn-outline-success" type="submit">Submit</button>
      </form>
      {% endif %}
    {% endif %}
  </div> {% endcomment %}

  <div class="container">
    <div class="row" style="display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-evenly; 
    height: 80vh;
    align-items: center;">
    <div class="main-content" style="background: rgba( 255, 255, 255, 0.25 );
      box-shadow: 0 5px 18px 0 rgba(26, 38, 135, 0.20 );
      backdrop-filter: blur( 4px );
      -webkit-backdrop-filter: blur( 4px );
      border-radius: 10px;
      border: 1px solid rgba( 255, 255, 255, 0.18 );">
        <div>
          <p style="padding-top: 30px"><b>Assignment name</b> : {{ assign.0.assignment_name }}</p> 
          <p><b>Assignment description</b> : {{ assign.0.assignment_description }}</p>
          <p><b>Marks</b> : {{ assign.0.max_marks }}</p>
          {% if marks != "" %}
          <p><b>Marks given by teacher</b> : {{ marks }}</p>
          {% else %}
          <p><b>Marks given by teacher</b> : Not given</p>
          {% endif %}
          <p><b>Due date</b> : {{ assign.0.duedate }}</p>
        </div>
          <form method="post" action="#" enctype="multipart/form-data" >
            {% csrf_token %}
            {% if submi.desc %}
            <input style="margin-bottom: 10px;" class="form-control" type="text" placeholder="Enter assignment description" name="description" required value="{{ submi.desc }}">
            {% else %}
            <input style="margin-bottom: 10px;" class="form-control" type="text" placeholder="Enter assignment description" name="description" required>
            {% endif %}
            <div class="form-group files">
              {% comment %} <div> {% endcomment %}
                {% if submi.file %}
                <input onchange="updateFiles()" id="file" type="file" class="form-control" accept="application/pdf" name="submission">
                {% else %}
                <input onchange="updateFiles()" id="file" type="file" class="form-control" name="submission" accept="application/pdf" required>
                {% endif %}
                {% comment %} <span>Upload pdf file</span> {% endcomment %}
              {% comment %} </div> {% endcomment %}
            </div>
            <div id="fileList">
              
            </div>
            <button class="btn btn-success" type="submit">Submit</button>
          </form>
      </div>
      {% if pflag %}
      <div class="col-md-4" style="background: rgba( 255, 255, 255, 0.25 );
      box-shadow: 0 5px 18px 0 rgba(26, 38, 135, 0.20 );
      backdrop-filter: blur( 4px );
      -webkit-backdrop-filter: blur( 4px );
      border-radius: 10px;
      border: 1px solid rgba( 255, 255, 255, 0.18 );">
        <div>
          <p style="padding-top: 30px"><b>Peer Grading</p>
            {% if desc1 != "X" and desc2 != "X" %}
            <form method="post">
                {% csrf_token %}
                <p>File: <a target="_blank" href="{{ desc1.assign_file.url }}">View Doc</a></p>
                {% if marks_1 != "" %}
                <input type="number" placeholder="Enter marks" name="peer1" step="0.01" value="{{marks_1}}" disabled>
                {% else %}
                <input type="number" placeholder="Enter marks" name="peer1" step="0.01" required>
                {% endif %}
                <p>File: <a target="_blank" href="{{ desc2.assign_file.url }}">View Doc</a></p>
                {% if marks_2 != "" %}
                <input type="number" placeholder="Enter marks" name="peer2" step="0.01" value="{{marks_2}}" disabled>
                {% else %}
                <input type="number" placeholder="Enter marks" name="peer2" step="0.01" required>
                {% endif %}
                <input type="text" name="caller" value="call" style="display: none">
                {% if marks_1 != "" and marks_2 != "" %}
                <button class="btn btn-outline-success" type="submit" disabled >Submit</button>
                {% else %}
                <button class="btn btn-outline-success" type="submit">Submit</button>
                {% endif %}
            </form>
            {% endif %}
      </div>
    </div>
    {% endif %}
    </div>
  </div>



  {% if submi %}
    <div style="margin-left: 10%; margin-right: 10%;" id="adobe-dc-view"></div>
  {% else %}
    <div id="adobe-dc-view" style="display: none;"></div>
  {% endif %}
  {% comment %} <a class="btn btn-outline-success" href="{% url 'classroom1' pk=pk pk2=pk2 %}">Back to classroom</a> {% endcomment %}
{% endblock content %}


{% block script %}

<script src="https://documentservices.adobe.com/view-sdk/viewer.js"></script>
<script>

  document.addEventListener("adobe_dc_view_sdk.ready", function()
    {
        var adobeDCView = new AdobeDC.View({clientId: "3b858419caa348589cf28e0a25d0dd52", divId: "adobe-dc-view"});
        adobeDCView.previewFile(
       {
          content:   {location: {url: "{{submi.file.url}}"}},
          metaData: {fileName: "{{submi.desc}}"}
       });
    });
    console.log("{{ submit.assign_file.url }}");

  // create a variable that fetched value from input field with id "file" every second
  var singleFile; 

  function updateFiles() {
    var fileNames = [];
    var file = document.getElementById("file");
    var fileList = document.getElementById("fileList");
    while (fileList.firstChild) {
      fileList.firstChild.remove()
    }
    if (file.files.length > 0) {  
      for (var i = 0; i < file.files.length; i++) {
        fileNames.push(file.files[i].name);
        // singleFile = file.files[i];
      }
      var div = document.createElement("div");
      div.style.padding = "10px";
      div.style.background = "rgba(255, 255, 255, 0.29)";
      div.style.borderRadius = "6px";
      div.style.boxShadow = "0 4px 30px rgba(0, 0, 0, 0.1)";
      div.style.backdropFilter = "blur(6.4px)";
      div.style.webkitBackdropFilter = "blur(6.4px)";
      div.style.border = "1px solid rgba(255, 255, 255, 0.24)";
      div.style.marginBottom = "10px";
      div.innerHTML = fileNames.join(", ");
      document.getElementById("fileList").appendChild(div);
    }
  }

</script>
<script src="https://documentservices.adobe.com/view-sdk/viewer.js"></script>
{% endblock script %}